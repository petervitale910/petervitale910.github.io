{
  "hash": "acbead64a8a37ee2d1c89f1d958b7fc7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aquaculture and EEZ's\"\ndescription: \"Examining where in the North Pacific Economic Exclusive Zone is best for aquaculture of different species\"\ndate: 2025-11-12\ncategories: [MEDS, R, Geospatial]\n---\n\nDESCRIPTION OF EEZ\"S AND WHY I LIKE THIS\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npacman::p_load('tidyverse', \n               'sf', \n               'here',\n               'tmap', \n               'kableExtra',\n               'patchwork',\n               'stars',\n               'terra')\n```\n:::\n\n\n## Data import\n\n### Surface temperature from: [@noaa_crw_sst31]\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsst_2008 <- rast(here('posts', 'aquaculture_and_eezs','data',\n                      'average_annual_sst_2008.tif')) \n\nsst_2009 <- rast(here('posts', 'aquaculture_and_eezs','data',\n                      'average_annual_sst_2009.tif'))\nsst_2010 <- rast(here('posts', 'aquaculture_and_eezs', 'data',\n                      'average_annual_sst_2010.tif'))\nsst_2011 <- rast(here('posts', 'aquaculture_and_eezs','data',\n                      'average_annual_sst_2011.tif'))\nsst_2012 <- rast(here('posts', 'aquaculture_and_eezs', 'data',\n                      'average_annual_sst_2012.tif'))\n```\n:::\n\n\n### Bathymetry\n\nFrom: [@gebcobathymetriccompilationgroup20252025]\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nbathy <- rast(here('posts', 'aquaculture_and_eezs', 'data','depth.tif')) %>% \n  project(\"EPSG:4326\") # Coerce into correct crs \n```\n:::\n\n\n### Exclusive Economic Zones\n\nFrom: [@marine_regions_eez_v12]\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\neez <- st_read(here('posts', 'aquaculture_and_eezs','data',\n                    'wc_regions_clean.shp'), quiet = TRUE) %>% \n  st_transform(\"EPSG:4326\") # STARS OBJECT\n```\n:::\n\n\n## Surface temperature mean\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Stacked raster\nstacked_sst <- c(sst_2008, sst_2009, sst_2010, sst_2011, sst_2012) %>% # Here we stack our temperatures and then transform crs\n  project(\"EPSG:4326\") \n\n# Take mean of stacked raster and transform from Kelvin to Celsius\nmean_sst <- mean(stacked_sst) - 273.15 \n```\n:::\n\n\n## Bathymetry\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# First we need to assure this data is in the same crs as sst\ndepth_projected <- project(bathy, mean_sst) # Project the crs of mean sst on depth \n\ncrs(depth_projected) == crs(mean_sst)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\n# We are going to crop the depth raster to the eez\ndepth_cropped <- crop(depth_projected, mean_sst)\n\n# And resample to make sure our pixel sizes match \ndepth_resampled <- resample(depth_projected, mean_sst)\n```\n:::\n\n\n## Oyster Reclassification\n\nWe need to reclassify for oysters, which enjoy depth between -70 meters and 0 meters and temperatures between 11 and 30 degrees celcius\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nrcl_depth <- matrix(c(-Inf, -70, 0, # Anything below 70 m becomes a 0\n                    -70, 0, 1, # Between 70 and 0 becomes 1\n                    0, Inf, 0), # And above 0 becomes a 0\n                    nrow = 3, \n                    byrow = TRUE)\n\nrcl_temp <- matrix(c(-Inf, 11, 0, # Below 11 degrees becomes 0\n                     11, 30, 1, # Between 11 and 30 becomes 1\n                     30, Inf, 0), # Above 30 becomes 0\n                   nrow =3,\n                   byrow = TRUE)\n# Apply those matrices\ndepth_rcl <- classify(depth_resampled, rcl_depth) \n\nsst_rcl <- classify(mean_sst, rcl_temp)\n```\n:::\n\n\nWe want to keep where both sst and depth equal one, so we can multiply the two rasters.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsuitable_cells <- sst_rcl * depth_rcl\n\n# And make all 0's NA\nsuitable_cells[suitable_cells == 0] <- NA\n\n# Finally, since we only have ones, change that to suitable\nnames(suitable_cells) <- 'Suitable'\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Now we want to see the area of the suitable cells, which we can get by multiplying suitable_cells and the cellSize of each cell\narea_raster <- suitable_cells * cellSize(suitable_cells, unit = 'km')  \n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Here we extract where that area touches our eez\narea_extracted <- terra::extract(area_raster, \n                                 eez, \n                                 touches = TRUE) %>%  \n  group_by(ID) %>% # Then we group_by and summarise the total suitable area per eez region\n  summarise(suitable_area = sum(Suitable, na.rm = TRUE)) %>% \n  mutate(rgn = eez$rgn)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Lastly we want to left join to preserve the area information of each eez region\nregion_suitable_area <- left_join(x = eez,\n                                  y = area_extracted, \n                                  by = \"rgn\") %>% \n  select(-ID) # Get rid of ID column\n```\n:::\n\n\n### Map\n\nNow we have our final mapping data frame and can build our map\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ntm_basemap(\"Esri.WorldTopoMap\")+# I found this basemap fit the best\ntm_shape(region_suitable_area)+\n  tm_polygons(fill = 'suitable_area',\n              fill.scale = tm_scale(values = c('#E1DABD', # Add my color palette \n                                              '#ABC798',\n                                              '#FFC4EB',\n                                              '#E6983F',\n                                              '#A0185A'),\n                                    breaks = c(0, \n                                               800, # Specify breaks \n                                               1600,\n                                               2400, \n                                               3200,\n                                               4000)),\n              fill.legend = tm_legend( '        Total \\nSuitable area (km)'))+ # The blank space makes 'Total' centered\n  tm_title(text = paste('Suitable area for farming Oysters in West Coast EEZ'), \n           position = tm_pos_out(\"center\", \"top\", pos.h = \"center\"))+ # Add title and position in center\n  tm_layout(component.autoscale = FALSE)+ # Autoscale makes our title tiny so we turn it off\n  tm_graticules(alpha = .5)+ # Add graticules (lighter)\n  tm_text('rgn', size = .7)+ # This adds the region name on each polygon centroid\ntm_shape(suitable_cells)+ # I want to add the visual representation of where the suitable area is \n  tm_raster(col  =  'Suitable',\n             col.scale =  tm_scale(values = '#90AFDA', # This color is also part of my palette\n            labels = 'Suitable Area'), # In place of a title  we will be specific with our legend text\n            col.legend = tm_legend(title = \"\")) # No need for a legend title with a single raster variable\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe visual variable `col` of the layer \"raster\" contains a unique value.\nTherefore a discrete scale is applied (tm_scale_discrete).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n### Table\n\nI also want to be able to see a table of our exact suitable area in each region so we can use kable\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nregion_suitable_area %>% \n  st_drop_geometry() %>% # The only way to lose geometry\n  select(-rgn_key, -rgn_id, -area_m2) %>% # Drop unnecesary columns\nkbl(col.names = c('Region', 'Total Area (Km2)', 'Suitable Area (Km2)')) %>%  # Rename the columns in our table\n  kable_classic(full_width = F, # This is my favorite type of table\n                html_font = \"Cambria\") %>% \n  footnote(number = paste('EEZ region suitable area for farming Oysters')) # Add a footnote\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Region </th>\n   <th style=\"text-align:right;\"> Total Area (Km2) </th>\n   <th style=\"text-align:right;\"> Suitable Area (Km2) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Oregon </td>\n   <td style=\"text-align:right;\"> 179994.06 </td>\n   <td style=\"text-align:right;\"> 1147.883 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Northern California </td>\n   <td style=\"text-align:right;\"> 164378.81 </td>\n   <td style=\"text-align:right;\"> 194.126 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Central California </td>\n   <td style=\"text-align:right;\"> 202738.33 </td>\n   <td style=\"text-align:right;\"> 3673.514 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Southern California </td>\n   <td style=\"text-align:right;\"> 206860.78 </td>\n   <td style=\"text-align:right;\"> 3259.485 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Washington </td>\n   <td style=\"text-align:right;\"> 66898.31 </td>\n   <td style=\"text-align:right;\"> 2524.804 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup>1</sup> EEZ region suitable area for farming Oysters</td></tr></tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n## Function\n\nNow that I have my workflow solidified I can turn it into a function, so with just the species name it can output a map.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n#' Map EEZ\n#' Make a map of a suitable area of a species in west coast EEZ's\n#' @param species \n#' The name of your species, MUST be wrapped AND Uppercase eg: ('Pacific Oyster')\n#' @returnsA list containing:\n#'   - $map   : tmap object\n#'   - $table : kable table\n#' @export\n#' @examples\n#' \nmap_eez <- function(species){\n\n  species_dict <- list(\n  \n  # -----------------------------\n  # SHELLFISH\n  # -----------------------------\n  \n  \"Pacific Oyster\" = list(\n    t_lwr = 11, t_upr = 30,\n    d_lower = 70, d_upr = 0\n  ),\n\n  \"Olympia Oyster\" = list(\n    t_lwr = 8,  t_upr = 20,\n    d_lower = 40, d_upr = 0\n  ),\n\n  \"Geoduck\" = list(\n    t_lwr = 5, t_upr = 18,\n    d_lower = 100, d_upr = 5\n  ),\n\n  \"Razor Clam\" = list(\n    t_lwr = 5, t_upr = 17,\n    d_lower = 20, d_upr = 0\n  ),\n\n  \"Blue Mussel\" = list(\n    t_lwr = 5, t_upr = 20,\n    d_lower = 30, d_upr = 0\n  ),\n\n  \"Mediterranean Mussel\" = list(\n    t_lwr = 8, t_upr = 26,\n    d_lower = 40, d_upr = 0\n  ),\n\n  \"Scallop\" = list(\n    t_lwr = 8, t_upr = 20,\n    d_lower = 50, d_upr = 0\n  ),\n  \n  # -----------------------------\n  # KELP + SEAWEEDS\n  # -----------------------------\n  \n  \"Bull Kelp\" = list(\n    t_lwr = 10, t_upr = 18,\n    d_lower = 40, d_upr = 0\n  ),\n  \n  \"Giant Kelp\" = list(\n    t_lwr = 6,  t_upr = 20,\n    d_lower = 30, d_upr = 0\n  ),\n  \n  \"Sugar Kelp\" = list(\n    t_lwr = -2, t_upr = 15,\n    d_lower = 50, d_upr = 1\n  ),\n  \n  \"Dulse\" = list(\n    t_lwr = 5,  t_upr = 15,\n    d_lower = 10, d_upr = 0\n  ),\n  \n  \"Sea Lettuce\" = list(\n    t_lwr = 5,  t_upr = 25,\n    d_lower = 10, d_upr = 0\n  ),\n  \n  \"Winged Kelp\" = list(\n    t_lwr = 2, t_upr = 15,\n    d_lower = 40, d_upr = 0\n  ),\n\n  \"Pyropia (Nori)\" = list(\n    t_lwr = 5,  t_upr = 15,\n    d_lower = 10, d_upr = 0\n  ),\n  \n  # -----------------------------\n  # ECHINODERMS (URCHINS)\n  # -----------------------------\n  \n  \"Green Sea Urchin\" = list(\n    t_lwr = 0, t_upr = 15,\n    d_lower = 200, d_upr = 0\n  ),\n\n  \"Red Sea Urchin\" = list(\n    t_lwr = 5, t_upr = 20,\n    d_lower = 100, d_upr = 3\n  ),\n  \n  # -----------------------------\n  # FINFISH\n  # -----------------------------\n\n  \"Chinook Salmon\" = list(\n    t_lwr = 8,  t_upr = 14,\n    d_lower = 200, d_upr = 0\n  ),\n\n  \"Coho Salmon\" = list(\n    t_lwr = 7, t_upr = 14,\n    d_lower = 150, d_upr = 0\n  ),\n\n  \"Steelhead Trout\" = list(\n    t_lwr = 7, t_upr = 17,\n    d_lower = 100, d_upr = 0\n  ),\n\n  \"Pacific Halibut\" = list(\n    t_lwr = 3,  t_upr = 12,\n    d_lower = 450, d_upr = 20\n  ),\n\n  \"Sablefish\" = list(\n    t_lwr = 4,  t_upr = 12,\n    d_lower = 1500, d_upr = 50\n  ),\n\n  \"Pacific Sardine\" = list(\n    t_lwr = 12, t_upr = 20,\n    d_lower = 0, d_upr = 50\n  ),\n\n  \"Northern Anchovy\" = list(\n    t_lwr = 12, t_upr = 20,\n    d_lower = 0, d_upr = 50\n  ),\n  \n  # -----------------------------\n  # CRUSTACEANS\n  # -----------------------------\n\n  \"Dungeness Crab\" = list(\n    t_lwr = 7, t_upr = 18,\n    d_lower = 100, d_upr = 0\n  )\n)\n\n# Extract parameters from the dictionary\nparams <- species_dict[[species]]\nif (is.null(params)) stop(\"Species not found in dictionary. Check spelling.\")\n\n# Access individual values\nt_lwr <- params$t_lwr\nt_upr <- params$t_upr\nd_lower <- params$d_lower\nd_upr   <- params$d_upr\n\n# Reclassification matrices\nrcl_depth <- matrix(c(-Inf, -d_lower, 0, # Use variables like values\n                      -d_lower, -d_upr, 1,\n                      -d_upr, Inf, 0), \n                    nrow = 3, \n                    byrow = TRUE)\n\nrcl_temp <- matrix(c(-Inf, t_lwr, 0,\n                     t_lwr, t_upr, 1,\n                     t_upr, Inf, 0), \n                   nrow =3,\n                   byrow = TRUE)\n\n# Reclassify \ndepth_rcl <- classify(depth_resampled, rcl_depth)\n\nsst_rcl <- classify(mean_sst, rcl_temp)\n\n# Calculate suitable cells\nsuitable_cells <- sst_rcl * depth_rcl\n\nsuitable_cells[suitable_cells == 0] <- NA\n\nnames(suitable_cells) <- 'Suitable'\n\n# Calculate area of suitable cells\narea_raster <- suitable_cells * cellSize(suitable_cells, unit = 'km')\n\n# Extract suitable areas \narea_extracted <- terra::extract(area_raster, \n                                 eez, \n                                 touches = TRUE) %>%  \n  group_by(ID) %>% \n  summarise(suitable_area = sum(Suitable, na.rm = TRUE)) %>% \n  mutate(rgn = eez$rgn)\n\n# Create geodf with suitable area and eez area\nregion_suitable_area <- left_join(x = eez,\n                                  y = area_extracted, \n                                  by = \"rgn\") %>% \n  select(-ID)\n\n\n# Create map\nmap <- tm_basemap(\"Esri.WorldTopoMap\")+\n  tm_shape(region_suitable_area)+\n  tm_polygons(fill = 'suitable_area',\n              fill.scale = tm_scale(values = c('#E1DABD',\n                                               '#ABC798',\n                                               '#FFC4EB',\n                                               '#E6983F',\n                                               '#A0185A'),\n                                    n = 5), # Set 5 breaks\n              fill.legend = tm_legend( '        Total \\nSuitable area (km)'))+\n  tm_title(text = paste('Suitable area for farming', species, 'in West Coast EEZ'), position = tm_pos_out(\"center\", \"top\", pos.h = \"center\"))+ # Paste allows us to manipulate the title of the plot\n  tm_layout(component.autoscale = FALSE)+\n  tm_graticules(alpha = .5)+\n  tm_text('rgn', size = .7)+\ntm_shape(suitable_cells)+\n  tm_raster(col  =  'Suitable',\n             col.scale =  tm_scale(values = '#90AFDA', \n            labels = 'Suitable Area'),\n            col.legend = tm_legend(title = \"\"))\n\n# Create table\ntable <- region_suitable_area %>% \n  st_drop_geometry() %>% \n  select(-rgn_key, -rgn_id, -area_m2) %>% \nkbl(col.names = c('Region', \n                  'Total Area (Km2)', \n                  'Suitable Area (Km2)')) %>% \n  kable_classic(full_width = F, \n                html_font = \"Cambria\") %>% \n  footnote(number = paste('EEZ region suitable area for farming', species)) # Paste again\n\nreturn(list( # Make a list of our map and table so they can be called with a buck\n    map = map, \n    table = table\n  ))\n}\n```\n:::\n\n\nNow we can call the function for bull kelp values: 10-18 degrees celsius, 40-0 meters deep according to [@weigel2023] and [@cdfw_kelp]\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbull_kelp <- map_eez('Bull Kelp')\n```\n:::\n\n\nCall the map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbull_kelp$map\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe visual variable `col` of the layer \"raster\" contains a unique value.\nTherefore a discrete scale is applied (tm_scale_discrete).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nCall the table\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbull_kelp$table\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style=\"font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Region </th>\n   <th style=\"text-align:right;\"> Total Area (Km2) </th>\n   <th style=\"text-align:right;\"> Suitable Area (Km2) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Oregon </td>\n   <td style=\"text-align:right;\"> 179994.06 </td>\n   <td style=\"text-align:right;\"> 1065.055 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Northern California </td>\n   <td style=\"text-align:right;\"> 164378.81 </td>\n   <td style=\"text-align:right;\"> 1023.031 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Central California </td>\n   <td style=\"text-align:right;\"> 202738.33 </td>\n   <td style=\"text-align:right;\"> 1674.401 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Southern California </td>\n   <td style=\"text-align:right;\"> 206860.78 </td>\n   <td style=\"text-align:right;\"> 1622.344 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Washington </td>\n   <td style=\"text-align:right;\"> 66898.31 </td>\n   <td style=\"text-align:right;\"> 3246.458 </td>\n  </tr>\n</tbody>\n<tfoot><tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup>1</sup> EEZ region suitable area for farming Bull Kelp</td></tr></tfoot>\n</table>\n\n`````\n:::\n:::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}